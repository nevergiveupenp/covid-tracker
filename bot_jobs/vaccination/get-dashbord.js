const axios = require('axios');
const census = require('../th-census-data.json');
/*
axios.post('https://wabi-south-east-asia-b-primary-api.analysis.windows.net/public/reports/querydata?synchronous=true',
    data = { "version": "1.0.0", "queries": [{ "Query": { "Commands": [{ "SemanticQueryDataShapeCommand": { "Query": { "Version": 2, "From": [{ "Name": "d", "Entity": "dim_person_type", "Type": 0 }, { "Name": "_", "Entity": "_Measure_real", "Type": 0 }, { "Name": "d1", "Entity": "dim_filter_date", "Type": 0 }, { "Name": "d2", "Entity": "dim_button", "Type": 0 }], "Select": [{ "Column": { "Expression": { "SourceRef": { "Source": "d" } }, "Property": "person_type_new" }, "Name": "dim_person_type.person_type_new" }, { "Measure": { "Expression": { "SourceRef": { "Source": "_" } }, "Property": "totalVaccineDose" }, "Name": "_Measure_real.totalVaccineDose" }], "Where": [{ "Condition": { "Not": { "Expression": { "In": { "Expressions": [{ "Column": { "Expression": { "SourceRef": { "Source": "d" } }, "Property": "person_type_new" } }], "Values": [[{ "Literal": { "Value": "null" } }]] } } } } }, { "Condition": { "In": { "Expressions": [{ "Column": { "Expression": { "SourceRef": { "Source": "d1" } }, "Property": "date_detail_th" } }], "Values": [[{ "Literal": { "Value": "'ทั้งหมด'" } }]] } } }, { "Condition": { "In": { "Expressions": [{ "Column": { "Expression": { "SourceRef": { "Source": "d2" } }, "Property": "detail" } }], "Values": [[{ "Literal": { "Value": "'เข็มสาม'" } }]] } } }], "OrderBy": [{ "Direction": 2, "Expression": { "Measure": { "Expression": { "SourceRef": { "Source": "_" } }, "Property": "totalVaccineDose" } } }] }, "Binding": { "Primary": { "Groupings": [{ "Projections": [0, 1] }] }, "DataReduction": { "DataVolume": 4, "Primary": { "Window": { "Count": 1000 } } }, "Version": 1 }, "ExecutionMetricsKind": 1 } }] }, "QueryId": "", "ApplicationContext": { "DatasetId": "d7159ff1-4b52-450a-a735-ce8d09f08cfb", "Sources": [{ "ReportId": "eb6c8df6-49d1-420c-9a92-a9c3bfd72f9c", "VisualId": "a0d4847ae75b99b8d7b3" }] } }], "cancelQueries": [], "modelId": 293549 }

)
    .then(res => {
        const data = res.data
        var result = data.results[0].result.data
        person_types = result.dsr.DS[0].ValueDicts.D0
        person_doses = result.dsr.DS[0].PH[0].DM0
        person_doses.map((person, index) => {
            console.log(person_types[index], person.C[1])
        })


    })
    .catch(err => {
        console.log(err.response)
    })
*/
//test1 = { "version": "1.0.0", "queries": [{ "Query": { "Commands": [{ "SemanticQueryDataShapeCommand": { "Query": { "Version": 2, "From": [{ "Name": "d", "Entity": "dim_person_type", "Type": 0 }, { "Name": "_", "Entity": "_Measure_real", "Type": 0 }, { "Name": "d1", "Entity": "dim_filter_date", "Type": 0 }, { "Name": "d2", "Entity": "dim_button", "Type": 0 }, { "Name": "d3", "Entity": "dim_region", "Type": 0 }], "Select": [{ "Column": { "Expression": { "SourceRef": { "Source": "d" } }, "Property": "person_type_new" }, "Name": "dim_person_type.person_type_new" }, { "Measure": { "Expression": { "SourceRef": { "Source": "_" } }, "Property": "totalVaccineDose" }, "Name": "_Measure_real.totalVaccineDose" }], "Where": [{ "Condition": { "Not": { "Expression": { "In": { "Expressions": [{ "Column": { "Expression": { "SourceRef": { "Source": "d" } }, "Property": "person_type_new" } }], "Values": [[{ "Literal": { "Value": "null" } }]] } } } } }, { "Condition": { "In": { "Expressions": [{ "Column": { "Expression": { "SourceRef": { "Source": "d1" } }, "Property": "date_detail_th" } }], "Values": [[{ "Literal": { "Value": "'ทั้งหมด'" } }]] } } }, { "Condition": { "In": { "Expressions": [{ "Column": { "Expression": { "SourceRef": { "Source": "d2" } }, "Property": "detail" } }], "Values": [[{ "Literal": { "Value": "'เข็มสาม'" } }]] } } }, { "Condition": { "In": { "Expressions": [{ "Column": { "Expression": { "SourceRef": { "Source": "d3" } }, "Property": "province_name_th" } }], "Values": [[{ "Literal": { "Value": "'เพชรบูรณ์'" } }]] } } }, { "Condition": { "Not": { "Expression": { "In": { "Expressions": [{ "Column": { "Expression": { "SourceRef": { "Source": "d3" } }, "Property": "province_name_en" } }], "Values": [[{ "Literal": { "Value": "null" } }]] } } } } }], "OrderBy": [{ "Direction": 2, "Expression": { "Measure": { "Expression": { "SourceRef": { "Source": "_" } }, "Property": "totalVaccineDose" } } }] }, "Binding": { "Primary": { "Groupings": [{ "Projections": [0, 1] }] }, "DataReduction": { "DataVolume": 4, "Primary": { "Window": { "Count": 1000 } } }, "Version": 1 }, "ExecutionMetricsKind": 1 } }] }, "QueryId": "", "ApplicationContext": { "DatasetId": "d7159ff1-4b52-450a-a735-ce8d09f08cfb", "Sources": [{ "ReportId": "eb6c8df6-49d1-420c-9a92-a9c3bfd72f9c", "VisualId": "a0d4847ae75b99b8d7b3" }] } }], "cancelQueries": [], "modelId": 293549 }
//test2 = { "version": "1.0.0", "queries": [{ "Query": { "Commands": [{ "SemanticQueryDataShapeCommand": { "Query": { "Version": 2, "From": [{ "Name": "d", "Entity": "dim_person_type", "Type": 0 }, { "Name": "_", "Entity": "_Measure_real", "Type": 0 }, { "Name": "d1", "Entity": "dim_filter_date", "Type": 0 }, { "Name": "d2", "Entity": "dim_button", "Type": 0 }, { "Name": "d3", "Entity": "dim_region", "Type": 0 }], "Select": [{ "Column": { "Expression": { "SourceRef": { "Source": "d" } }, "Property": "person_type_new" }, "Name": "dim_person_type.person_type_new" }, { "Measure": { "Expression": { "SourceRef": { "Source": "_" } }, "Property": "totalVaccineDose" }, "Name": "_Measure_real.totalVaccineDose" }], "Where": [{ "Condition": { "Not": { "Expression": { "In": { "Expressions": [{ "Column": { "Expression": { "SourceRef": { "Source": "d" } }, "Property": "person_type_new" } }], "Values": [[{ "Literal": { "Value": "null" } }]] } } } } }, { "Condition": { "In": { "Expressions": [{ "Column": { "Expression": { "SourceRef": { "Source": "d1" } }, "Property": "date_detail_th" } }], "Values": [[{ "Literal": { "Value": "'ทั้งหมด'" } }]] } } }, { "Condition": { "In": { "Expressions": [{ "Column": { "Expression": { "SourceRef": { "Source": "d2" } }, "Property": "detail" } }], "Values": [[{ "Literal": { "Value": "'เข็มสาม'" } }]] } } }, { "Condition": { "In": { "Expressions": [{ "Column": { "Expression": { "SourceRef": { "Source": "d3" } }, "Property": "province_name_th" } }], "Values": [[{ "Literal": { "Value": "'" + province + "'" } }]] } } }, { "Condition": { "Not": { "Expression": { "In": { "Expressions": [{ "Column": { "Expression": { "SourceRef": { "Source": "d3" } }, "Property": "province_name_en" } }], "Values": [[{ "Literal": { "Value": "null" } }]] } } } } }], "OrderBy": [{ "Direction": 2, "Expression": { "Measure": { "Expression": { "SourceRef": { "Source": "_" } }, "Property": "totalVaccineDose" } } }] }, "Binding": { "Primary": { "Groupings": [{ "Projections": [0, 1] }] }, "DataReduction": { "DataVolume": 4, "Primary": { "Window": { "Count": 1000 } } }, "Version": 1 }, "ExecutionMetricsKind": 1 } }] }, "QueryId": "", "ApplicationContext": { "DatasetId": "d7159ff1-4b52-450a-a735-ce8d09f08cfb", "Sources": [{ "ReportId": "eb6c8df6-49d1-420c-9a92-a9c3bfd72f9c", "VisualId": "a0d4847ae75b99b8d7b3" }] } }], "cancelQueries": [], "modelId": 293549 }
//test3 = { "version": "1.0.0", "queries": [{ "Query": { "Commands": [{ "SemanticQueryDataShapeCommand": { "Query": { "Version": 2, "From": [{ "Name": "d", "Entity": "dim_person_type", "Type": 0 }, { "Name": "_", "Entity": "_Measure_real", "Type": 0 }, { "Name": "d1", "Entity": "dim_filter_date", "Type": 0 }, { "Name": "d2", "Entity": "dim_button", "Type": 0 }, { "Name": "d3", "Entity": "dim_region", "Type": 0 }], "Select": [{ "Column": { "Expression": { "SourceRef": { "Source": "d" } }, "Property": "person_type_new" }, "Name": "dim_person_type.person_type_new" }, { "Measure": { "Expression": { "SourceRef": { "Source": "_" } }, "Property": "totalVaccineDose" }, "Name": "_Measure_real.totalVaccineDose" }], "Where": [{ "Condition": { "Not": { "Expression": { "In": { "Expressions": [{ "Column": { "Expression": { "SourceRef": { "Source": "d" } }, "Property": "person_type_new" } }], "Values": [[{ "Literal": { "Value": "null" } }]] } } } } }, { "Condition": { "In": { "Expressions": [{ "Column": { "Expression": { "SourceRef": { "Source": "d1" } }, "Property": "date_detail_th" } }], "Values": [[{ "Literal": { "Value": "'ทั้งหมด'" } }]] } } }, { "Condition": { "In": { "Expressions": [{ "Column": { "Expression": { "SourceRef": { "Source": "d2" } }, "Property": "detail" } }], "Values": [[{ "Literal": { "Value": "'เข็มสาม'" } }]] } } }, { "Condition": { "In": { "Expressions": [{ "Column": { "Expression": { "SourceRef": { "Source": "d3" } }, "Property": "province_name_th" } }], "Values": [[{ "Literal": { "Value": "'ภูเก็ต'" } }]] } } }, { "Condition": { "Not": { "Expression": { "In": { "Expressions": [{ "Column": { "Expression": { "SourceRef": { "Source": "d3" } }, "Property": "province_name_en" } }], "Values": [[{ "Literal": { "Value": "null" } }]] } } } } }], "OrderBy": [{ "Direction": 2, "Expression": { "Measure": { "Expression": { "SourceRef": { "Source": "_" } }, "Property": "totalVaccineDose" } } }] }, "Binding": { "Primary": { "Groupings": [{ "Projections": [0, 1] }] }, "DataReduction": { "DataVolume": 4, "Primary": { "Window": { "Count": 1000 } } }, "Version": 1 }, "ExecutionMetricsKind": 1 } }] }, "QueryId": "", "ApplicationContext": { "DatasetId": "d7159ff1-4b52-450a-a735-ce8d09f08cfb", "Sources": [{ "ReportId": "eb6c8df6-49d1-420c-9a92-a9c3bfd72f9c", "VisualId": "a0d4847ae75b99b8d7b3" }] } }], "cancelQueries": [], "modelId": 293549 }
async function boosted_group_by_province(province) {
    const res = await axios.post(
        'https://wabi-south-east-asia-b-primary-api.analysis.windows.net/public/reports/querydata?synchronous=true',
        { "version": "1.0.0", "queries": [{ "Query": { "Commands": [{ "SemanticQueryDataShapeCommand": { "Query": { "Version": 2, "From": [{ "Name": "d", "Entity": "dim_person_type", "Type": 0 }, { "Name": "_", "Entity": "_Measure_real", "Type": 0 }, { "Name": "d1", "Entity": "dim_filter_date", "Type": 0 }, { "Name": "d2", "Entity": "dim_button", "Type": 0 }, { "Name": "d3", "Entity": "dim_region", "Type": 0 }], "Select": [{ "Column": { "Expression": { "SourceRef": { "Source": "d" } }, "Property": "person_type_new" }, "Name": "dim_person_type.person_type_new" }, { "Measure": { "Expression": { "SourceRef": { "Source": "_" } }, "Property": "totalVaccineDose" }, "Name": "_Measure_real.totalVaccineDose" }], "Where": [{ "Condition": { "Not": { "Expression": { "In": { "Expressions": [{ "Column": { "Expression": { "SourceRef": { "Source": "d" } }, "Property": "person_type_new" } }], "Values": [[{ "Literal": { "Value": "null" } }]] } } } } }, { "Condition": { "In": { "Expressions": [{ "Column": { "Expression": { "SourceRef": { "Source": "d1" } }, "Property": "date_detail_th" } }], "Values": [[{ "Literal": { "Value": "'ทั้งหมด'" } }]] } } }, { "Condition": { "In": { "Expressions": [{ "Column": { "Expression": { "SourceRef": { "Source": "d2" } }, "Property": "detail" } }], "Values": [[{ "Literal": { "Value": "'เข็มสาม'" } }]] } } }, { "Condition": { "In": { "Expressions": [{ "Column": { "Expression": { "SourceRef": { "Source": "d3" } }, "Property": "province_name_th" } }], "Values": [[{ "Literal": { "Value": "'" + province + "'" } }]] } } }, { "Condition": { "Not": { "Expression": { "In": { "Expressions": [{ "Column": { "Expression": { "SourceRef": { "Source": "d3" } }, "Property": "province_name_en" } }], "Values": [[{ "Literal": { "Value": "null" } }]] } } } } }], "OrderBy": [{ "Direction": 2, "Expression": { "Measure": { "Expression": { "SourceRef": { "Source": "_" } }, "Property": "totalVaccineDose" } } }] }, "Binding": { "Primary": { "Groupings": [{ "Projections": [0, 1] }] }, "DataReduction": { "DataVolume": 4, "Primary": { "Window": { "Count": 1000 } } }, "Version": 1 }, "ExecutionMetricsKind": 1 } }] }, "QueryId": "", "ApplicationContext": { "DatasetId": "d7159ff1-4b52-450a-a735-ce8d09f08cfb", "Sources": [{ "ReportId": "eb6c8df6-49d1-420c-9a92-a9c3bfd72f9c", "VisualId": "a0d4847ae75b99b8d7b3" }] } }], "cancelQueries": [], "modelId": 293549 }
    )
    const data = res.data
    var result = data.results[0].result.data
    person_types = result.dsr.DS[0].ValueDicts.D0
    person_doses = result.dsr.DS[0].PH[0].DM0
    var province_data = []
    for (index in person_types) {
        province_data.push({
            type: person_types[index],
            doses: person_doses[index].C[1]
        })
    }
    return province_data
}

(async () => {

    for (const i in census) {
        try {
            const province_data = await boosted_group_by_province(census[i].province)
            console.log(province_data)
        }
        catch (err) {
            console.log(census[i].province)
            continue
        }
    }

})();
